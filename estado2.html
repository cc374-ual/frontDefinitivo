<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>File Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <nav>
        <div class="logo">
            <span>Suricata Web Config</span>
        </div>
        <a href="index.html">Inicio</a>
        <a href="alertas.html">Alertas</a>
        <a href="configuracion.html">Configuración</a>
        <a href="estado.html">Estado</a>
    </nav>
    <div class="states">
    <table class="table" id="tabla-estados">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Estado</th>
                <th>Puertos</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="tbody-states">
            <!-- Aquí se insertarán las filas de la tabla -->
        </tbody>
    </table>
    </div>
    <script>
        $(document).ready(function(){
            $.get('http://192.168.227.128:3000/estado-contenedores', function(estados){
                $.each(estados, function(nombre,estado){
                    let indicadorClase = estado.estado.toLowerCase() === 'up' ? 'Activo' : 'Inactivo';
                    <!-- let puertos = estado.puertos.map(puerto => puerto.replace(/0\.0\.0\.0:|127\.0\.0\.1:|\/tcp|\/udp/g, '')).join(', '); -->
                    let puertos = estado.puertos.map(puerto => puerto.replace(/0\.0\.0\.0:|127\.0\.0\.1:|\/tcp|\/udp|\s*->.*/g, '').match(/\d+/)[0]).join(', ');
                    let accionBoton = indicadorClase === 'Activo' ? 'Apagar' : 'Encender';
                    let filaId = 'fila-' + nombre;
                   // console.log(indicadorClase);
                    $('#tbody-states').append(`
                    <tr id="${filaId}">
                        <td>${nombre}</td>
                        <td><div class="${indicadorClase}">${indicadorClase}</div></td>
                        <td>${puertos}</td>
                        <td><button class= "accion-btn${indicadorClase}" onclick="actualizarEstado('${nombre}','${indicadorClase}')">${accionBoton}</button></td>
                    </tr>`);
                });
                
            });
        });

        function actualizarEstado(nombreContenedor,indicadorClase){
        
            var datos = {
                nombre: nombreContenedor,
                indicador: indicadorClase}

            
            fetch('http://192.168.227.128:3000/actualizar-estado', {
             method: 'POST',
             headers: {
                'Content-Type': 'application/json'
              },
            body: JSON.stringify(datos)
            }).then(function(response){
                window.location.reload();
                //actualizarFila(nombreContenedor,indicadorClase);
                
            });
        }

        function actualizarFila(nombreContenedor,indicador){
            var filaId = 'fila-' + nombreContenedor;
            console.log(filaId);
            console.log(nombreContenedor);
            console.log(indicador);
            if(indicador == "Inactivo") 
            {
                indicador = "Activo";
            }else {
                indicador = "Inactivo";
            }
            var boton = indicador === 'Activo' ? 'Apagar' : 'Encender';
            $('#' + filaId + ' div').text(indicador);
            $('#' + filaId + ' button').text(boton);
        }

    </script>
</body>
</html>
